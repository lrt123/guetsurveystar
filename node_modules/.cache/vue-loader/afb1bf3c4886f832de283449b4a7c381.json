{"remainingRequest":"F:\\github\\guetsurveystar\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\github\\guetsurveystar\\src\\components\\Analysis\\MainAnalysisList.vue?vue&type=style&index=0&id=65e8c1e6&scoped=true&lang=css&","dependencies":[{"path":"F:\\github\\guetsurveystar\\src\\components\\Analysis\\MainAnalysisList.vue","mtime":1593309905220},{"path":"F:\\github\\guetsurveystar\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\github\\guetsurveystar\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"F:\\github\\guetsurveystar\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"F:\\github\\guetsurveystar\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\github\\guetsurveystar\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubWFpbi1hbmFseXNpcy1saXN0IHsKICAgIHdpZHRoOiA3MCU7CiAgICBtYXJnaW46IGF1dG87Cn0KCi5kZXNjcmlwdGlvbi1ib3ggewogICAgdGV4dC1hbGlnbjogbGVmdDsKICAgIHBhZGRpbmctbGVmdDogMTAlOwogICAgbGluZS1oZWlnaHQ6IDMwcHg7CiAgICBmb250LXNpemU6IDE0cHg7Cn0KI2V4cG9ydF9idG57CiAgICBtYXJnaW4tdG9wOiAxMHB4OwogICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgIGZsb2F0OiByaWdodDsKfQo="},{"version":3,"sources":["MainAnalysisList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmLA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MainAnalysisList.vue","sourceRoot":"src/components/Analysis","sourcesContent":["<template>\n    <div>\n        <div class=\"main-analysis-list\">\n            <el-card>\n                <h1>{{questionnaire.title}}</h1>\n                <div class=\"description-box\">\n                    <div>\n                        <b>问卷状态：</b>{{questionnaire.status}}\n                    </div>\n                    <div>\n                        <b>填写人数：</b>{{questionnaire.fillCount}}\n                    </div>\n                    <div>\n                        <b>发布时间：</b>{{questionnaire.startTime}}\n                    </div>\n                    <div>\n                        <b>截止时间：</b>{{questionnaire.endTime}}\n                    </div>\n                    <el-tabs v-if=\"tabVisible\" v-model=\"selectedTab\" @tab-click=\"tabClick\">\n                        <el-tab-pane label=\"查看选项统计\" name=\"option\"></el-tab-pane>\n                        <el-tab-pane label=\"课程目标达成情况\" name=\"detail\"></el-tab-pane>\n                    </el-tabs>\n                </div>\n                <el-button v-if=\"detailVisible\" type=\"primary\" @click=\"exportToExcel\" round id=\"export_btn\">导出</el-button>\n            </el-card>\n            <AnalysisCard\n                    v-if=\"detailVisible===false\"\n                    v-for=\"(item,index) in questionList\"\n                    :key=\"index\"\n                    :question-index=\"index+1\"\n                    :question-id=\"item.questionId\"\n                    :question-title=\"item.questionTitle\"\n                    :question-type=\"item.questionType\"\n                    :question-value-list=\"item.questionValueList\"\n            >\n            </AnalysisCard>\n            <div v-if=\"detailVisible\">\n\n                <el-table\n                        :data=\"detailInfo\"\n                        :default-sort=\"{prop:'account',order:'ascending'}\"\n                >\n                    <el-table-column\n                            prop=\"account\"\n                            label=\"学号\">\n                    </el-table-column>\n                    <el-table-column\n                            prop=\"name\"\n                            label=\"姓名\">\n                    </el-table-column>\n                    <el-table-column\n                            prop=\"major\"\n                            label=\"专业\">\n                    </el-table-column>\n                    <el-table-column\n                            prop=\"score\"\n                            label=\"得分\">\n                    </el-table-column>\n                </el-table>\n\n            </div>\n\n        </div>\n    </div>\n\n</template>\n\n<script>\n    import AnalysisCard from \"./AnalysisCard\";\n\n    export default {\n        name: \"MainAnalysisList\",\n        components: {AnalysisCard},\n        methods: {\n            fetchData() {\n              this.$http.get(\"/questionnaire/\"+this.$route.params.qid+\"/analyze\", {\n              }).then((res) => {\n                const data = res.data.data;\n                this.questionnaire.title = data.title\n                  this.questionnaire.startTime = data.start_time\n                  this.questionnaire.endTime = data.end_time\n                const temp = data.questions;\n\n                let dataList = [];\n                for (const t of temp){\n                  for (const i of t.items){\n                    dataList.push({'name': i.myoption, 'value': i.count})\n                  }\n                  dataList.sort((a, b) => {\n                    return a.value - b.value\n                  });\n                  dataList.push({'name':'','static': '总计', 'static_value': t.total})\n                    this.questionnaire.fillCount = t.total\n                    this.questionList.push(\n                        {\n                            questionId:t.index,\n                            questionTitle:t.desc,\n                            questionType:t.type,\n                            questionValueList:dataList\n                        }\n                    )\n                  dataList = []\n                }\n                console.log(this.questionList)\n\n              }).catch(() => {\n                this.$message({message: \"error！无数据！\", duration: 1000})\n              })\n            },\n            detail(){\n                    this.$http.get(\"/questionnaire/\"+this.$route.params.qid+\"/analyze/lesson\",{\n                    }).then((res) => {\n                        if (res.data.code === 0){\n                            let data = res.data.data\n                            this.detailInfo = data.data\n                            this.detailVisible = true\n                        }else{\n                            this.$message({message: \"error! 读取失败！\", duration: 1000})\n                        }\n                    }).catch(res => {\n                        this.$message({message: \"error! 服务端无响应！\", duration: 1000})\n                    });\n\n            },\n            tabClick(tab,event){\n                if (tab.name === 'detail'){\n                    this.detail()\n                }else if (tab.name === 'option'){\n                    this.detailVisible = false\n                }\n            },\n             exportToExcel() {\n              //excel数据导出\n             require.ensure([], () => {\n                   const {\n                     export_json_to_excel\n                       } = require('../../assets/js/Export2Excel');\n                   const tHeader = ['学号','姓名', '专业', '得分'];\n                   const filterVal = ['account','name', 'major', 'score'];\n                   const list = this.detailInfo;\n                   const data = this.formatJson(filterVal, list);\n                   export_json_to_excel(tHeader, data, this.questionnaire.title+'-统计情况');\n                 })\n             },\n             formatJson(filterVal, jsonData) {\n                return jsonData.map(v => filterVal.map(j => v[j]))\n                   }\n\n    },\n        mounted() {\n            this.fetchData();\n            console.log(123,this.$route.params)\n                let type = this.$route.params.type\n                if (type !== 1){\n                    this.tabVisible = false\n                }\n                console.log(this.$route.params.type)\n        },\n        data: function () {\n            return {\n                questionnaire: {\n                    title: '这是一个标题',\n                    status: '已完成',\n                    startTime: \"2020-6-18 19:00:25\",\n                    endTime: \"2020-7-1 20:00:00\",\n                    fillCount: 299,\n                },\n                questionList: [],\n                showDetail: false,\n                detailVisible: false,\n                tabVisible: true,\n                selectedTab:'option',\n                detailInfo: []\n            }\n        }\n    }\n</script>\n\n<style scoped>\n    .main-analysis-list {\n        width: 70%;\n        margin: auto;\n    }\n\n    .description-box {\n        text-align: left;\n        padding-left: 10%;\n        line-height: 30px;\n        font-size: 14px;\n    }\n    #export_btn{\n        margin-top: 10px;\n        margin-bottom: 10px;\n        float: right;\n    }\n</style>\n"]}]}